# Telegram logistic
## Change language: [English](README.en.md)
***
Бот для помощи в осуществлении логистики.
## [DEMO](README.demo.md)
## Функционал:
1. Администратор контролирует пользователей, имеющих доступ к боту
2. Рассылка маршрутов водителям на базе данных google таблиц
3. Перенос информации, поступающей от водителей в google таблицы
4. Внесение изменений в исполняющиеся маршруты, оповещение водителей о внесенных изменениях
5. Валидация корректного заполнения таблиц
6. Работа с неограниченным количеством листов
## Команды:
**Для удобства рекомендуется добавить данные команды в боковое меню бота, используя [BotFather](https://t.me/BotFather).**
- connect - вызывает кнопку связи с администратором

**Команды доступные только администратору:**
- allow - команда, предоставляющая водителям доступ к боту, через пробел от команды необходимо указать ник пользователя в телеграмм (н.р. /allow username);
- disallow - команда, лишающая водителей доступа к боту, через пробел от команды необходимо указать ник пользователя в телеграмм (н.р. /disallow username)
- all_users - команда, которая выводит список всех пользователей со статусом доступа
- send_routes - команда, отправляющая маршруты водителям, через пробел необходимо указать название листа с информацией о маршрутах (н.р. /send_routes routes). **ВАЖНО:** удаляет из базы данных все предыдущие маршруты, неоконченные окрашивает в серый цвет в google таблицах.
- update_routes - команда, позволяющая внести изменения в ранее добавленные маршруты (изменения адресов, их порядка, добавление новых и пр.), через пробел необходимо указать название листа с информацией о маршрутах (н.р. /update_routes routes). **ВАЖНО:** если изменения внесены в адрес, который уже был посещен водителем или к которому водитель направляется, то у водителя маршрут останется без изменений, администратору придет предупреждение о том, что маршрут не был изменен.
- stop - команда, прерывающая выполнение маршрута водителе, через пробел необходимо указать идентификатор маршрута из google таблицы (н.р. /stop 123, используется когда необходимо прервать маршрут и полностью его обновить (после применения команды /stop и добавления нового маршрута с уникальным идентификатором следует воспользоваться командой update_routes)
- help - команда, выводящая подсказку по использованию

## Установка и использование:
- Установить зависимости:
```sh
pip install -r requirements.txt
```
- в файле .env указать:\
  - Токен телеграмм бота: **TELEBOT_TOKEN**=ТОКЕН\
  - ID бота: **BOT_ID**=ID (первые цифры из токена бота, до :)\
  - ID менеджера: **MANAGER_ID**=MANAGER_ID; будет иметь право на выполнение команды /update, ему будут приходить уведомления - для получения уведомлений менеджеру необходимо активировать бота со своего аккаунта (нажать кнопку "начать")
  > Для определения ID пользователя нужно отправить следующему [боту](https://t.me/getmyid_bot) любое сообщение с соответствующего аккаунта. Значение, содержащееся в **Your user ID** - ID пользователя
  - Username менеджера - на указанный профиль введет кнопка "администратор" при использовании команды /connect: **MANAGER_USERNAME**=example (указывается без @)\
  - Название google таблицы: **SPREAD_NAME**=logistic (не используйте в названии пробелы и "_" - нижние подчеркивания)\
  - Название листа, на который бот вносит информацию: **LIST_BOT**=бот (не используйте в названии пробелы и "_" - нижние подчеркивания)
- получить файл c credentials (параметрами для подключения):\
https://console.cloud.google.com/ \
https://www.youtube.com/watch?v=bu5wXjz2KvU - инструкция с 00:00 по 02:35\
Полученный файл сохранить в корне проекта, с именем **service_account.json**
- предоставить сервисному e-mail доступ к таблице (инструкция в видео по ссылке выше)
- запустить проект:
```sh
python3 main.py
```
## Рекомендации по использованию:
- в наименовании таблицы и листов не использовать пробельные символы и нижние подчеркивания
- лист с информацией, заполняемой ботом должен содержать 152 столбца (уникальный ID, ФИО + 25 наборов полей для адресов)
- порядок выводимой информации на листе с информацией, заполняемой ботом (заголовок генерируется автоматически):
    1. уникальный ID маршрута, не должен повторяться  
    2. ФИО
    3. Адрес №1
    4. Время и дата прибытия
    5. Сообщение от водителя
    6. Статус
    7. Время и дата убытия
    8. Погрузочные работы
> далее пункты с 3 по 8 повторяются
- порядок информации на листе, заполняемом логистом (заголовок необходимо формировать самостоятельно):
    1. уникальный ID маршрута (должен быть уникален на все время использования бота, можно использовать **только цифры**) (заголовок должен содержать слово "ID" - не чувствительно к регистру)
    2. Ник водителя в telegram (заполняется без @) (заголовок должен содержать слово "TELEGRAM" - не чувствительно к регистру)
    3. ФИО водителя (заголовок должен содержать слово "ФИО" - не чувствительно к регистру)
    4. Адрес №1 (заголовок должен содержать слово "Адрес" - не чувствительно к регистру)
    5. Телефон №1 (заголовок должен содержать слово "Телефон" - не чувствительно к регистру)
    6. Сообщение №1 (заголовок должен содержать слово "Сообщение" - не чувствительно к регистру)
> далее пункты 4,5,6 повторяются (нельзя опускать ни один), если заполнен телефон или сообщение - адрес не может быть пустым.
- бот начинает заполнение с первой пустой строки (проверка ведется по столбцу A) - не оставлять это столбец пустым в верхней части таблицы
- не создавать дополнительные столбцы, не вносить информацию, не предусмотренную в техническом задании - может сказаться на корректности работы

## Особенности использования: 
1. Каждую кнопку необходимо нажимать лишь один раз, после этого бот начинает обрабатывать данные, по завершении процесса, меняя выводимую информацию
2. В один маршрут может быть добавлено не более 25 адресов
3. Предоставление пользователям доступа к боту происходит с помощью указания ника в телеграмм
4. Опции добавления точек в конец маршрута и изменения порядка объединены в одну команды /update_routes
5. При необходимости полностью остановить маршрут следует воспользоваться командой /stop
6. Команда /update_routes исключает необходимость в персональном обновлении информации для каждого водителя
7. Для связи с администратором водителю необходимо воспользоваться командой /connect
8. Администратору необходимо дождаться ответа на введенную команду, прежде чем вводить следующую